# Migration `20200918022429`

This migration has been generated by Kullanan at 9/18/2020, 9:24:29 AM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TYPE "public"."Role" AS ENUM ('ADMIN', 'USER')

CREATE TABLE "public"."User" (
"id" SERIAL,
"email" text   NOT NULL ,
"name" text   ,
"image" text   ,
"position" text   ,
"skills" text []  ,
"role" "Role"  NOT NULL DEFAULT E'USER',
PRIMARY KEY ("id")
)

CREATE TABLE "public"."Contact" (
"id" SERIAL,
"facebook" text   ,
"twitter" text   ,
"instagram" text   ,
"gitlab" text   ,
"github" text   ,
"userId" integer   ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."Project" (
"id" SERIAL,
"projectName" text   ,
"projectType" text   ,
"projectDetail" text   ,
"projectImage" text   ,
"status" text   DEFAULT E'undone',
"dueDate" timestamp(3)   NOT NULL ,
"memberIds" integer   ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."Task" (
"id" SERIAL,
"projectId" integer   ,
"taskName" text   ,
"startTime" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"endTime" timestamp(3)   NOT NULL ,
"taskDetail" text   ,
"isDone" boolean   NOT NULL ,
"memberIds" integer   ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."File" (
"id" SERIAL,
"url" text   ,
"name" text   ,
"status" text   ,
"taskId" integer   ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."Comment" (
"id" SERIAL,
"timestamp" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"userId" integer   ,
"userImg" text   ,
"userName" text   ,
"image" text   ,
"message" text   ,
"taskId" integer   ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."_ProjectToUser" (
"A" integer   NOT NULL ,
"B" integer   NOT NULL 
)

CREATE TABLE "public"."_TaskToUser" (
"A" integer   NOT NULL ,
"B" integer   NOT NULL 
)

CREATE UNIQUE INDEX "User.email_unique" ON "public"."User"("email")

CREATE UNIQUE INDEX "_ProjectToUser_AB_unique" ON "public"."_ProjectToUser"("A", "B")

CREATE INDEX "_ProjectToUser_B_index" ON "public"."_ProjectToUser"("B")

CREATE UNIQUE INDEX "_TaskToUser_AB_unique" ON "public"."_TaskToUser"("A", "B")

CREATE INDEX "_TaskToUser_B_index" ON "public"."_TaskToUser"("B")

ALTER TABLE "public"."Contact" ADD FOREIGN KEY ("userId")REFERENCES "public"."User"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."Project" ADD FOREIGN KEY ("memberIds")REFERENCES "public"."User"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."Task" ADD FOREIGN KEY ("projectId")REFERENCES "public"."Project"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."Task" ADD FOREIGN KEY ("memberIds")REFERENCES "public"."User"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."File" ADD FOREIGN KEY ("taskId")REFERENCES "public"."Task"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."Comment" ADD FOREIGN KEY ("userId")REFERENCES "public"."User"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."Comment" ADD FOREIGN KEY ("taskId")REFERENCES "public"."Task"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."_ProjectToUser" ADD FOREIGN KEY ("A")REFERENCES "public"."Project"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."_ProjectToUser" ADD FOREIGN KEY ("B")REFERENCES "public"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."_TaskToUser" ADD FOREIGN KEY ("A")REFERENCES "public"."Task"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."_TaskToUser" ADD FOREIGN KEY ("B")REFERENCES "public"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration ..20200918022429
--- datamodel.dml
+++ datamodel.dml
@@ -1,0 +1,88 @@
+generator prisma_client {
+  provider = "prisma-client-js"
+}
+
+datasource db {
+  provider = "postgresql"
+  url = "***"
+}
+
+model User {
+  id         Int       @id @default(autoincrement())
+  email      String    @unique
+  name       String?
+  image      String?
+  position   String?
+  skills     String[]
+  contacts   Contact[]
+  projectIds Project[]
+  taskIds    Task[]
+  comments   Comment[]
+  role       Role      @default(USER)
+}
+
+model Contact {
+  id        Int     @id @default(autoincrement())
+  facebook  String?
+  twitter   String?
+  instagram String?
+  gitlab    String?
+  github    String?
+  user      User?   @relation(fields: [userId], references: [id])
+  userId    Int?
+}
+
+model Project {
+  id            Int      @id @default(autoincrement())
+  projectName   String?
+  projectType   String?
+  projectDetail String?
+  projectImage  String?
+  status        String?  @default(value: "undone")
+  dueDate       DateTime
+  users         User[]   @relation(fields: [memberIds], references: [id])
+  memberIds     Int?
+  task          Task[]
+}
+
+model Task {
+  id         Int       @id @default(autoincrement())
+  Project    Project?  @relation(fields: [projectId], references: [id])
+  projectId  Int?
+  taskName   String?
+  startTime  DateTime  @default(now())
+  endTime    DateTime
+  taskDetail String?
+  isDone     Boolean
+  users      User[]    @relation(fields: [memberIds], references: [id])
+  memberIds  Int?
+  comments   Comment[]
+  files      File[]
+}
+
+model File {
+  id     Int     @id @default(autoincrement())
+  url    String?
+  name   String?
+  status String?
+  task   Task?   @relation(fields: [taskId], references: [id])
+  taskId Int?
+}
+
+model Comment {
+  id        Int      @id @default(autoincrement())
+  timestamp DateTime @default(now())
+  users     User?    @relation(fields: [userId], references: [id])
+  userId    Int?
+  userImg   String?
+  userName  String?
+  image     String?
+  message   String?
+  task      Task?    @relation(fields: [taskId], references: [id])
+  taskId    Int?
+}
+
+enum Role {
+  ADMIN
+  USER
+}
```



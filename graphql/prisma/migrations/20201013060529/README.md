# Migration `20201013060529`

This migration has been generated by Kullanan at 10/13/2020, 1:05:30 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
ALTER TABLE "public"."ProjectOnUser" DROP CONSTRAINT "ProjectOnUser_projectId_fkey"

ALTER TABLE "public"."ProjectOnUser" DROP CONSTRAINT "ProjectOnUser_userId_fkey"

CREATE TABLE "public"."_ProjectToUser" (
"A" integer   NOT NULL ,
"B" integer   NOT NULL 
)

CREATE UNIQUE INDEX "_ProjectToUser_AB_unique" ON "public"."_ProjectToUser"("A", "B")

CREATE INDEX "_ProjectToUser_B_index" ON "public"."_ProjectToUser"("B")

ALTER TABLE "public"."_ProjectToUser" ADD FOREIGN KEY ("A")REFERENCES "public"."Project"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."_ProjectToUser" ADD FOREIGN KEY ("B")REFERENCES "public"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE

DROP TABLE "public"."ProjectOnUser"
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20201007061829..20201013060529
--- datamodel.dml
+++ datamodel.dml
@@ -3,26 +3,26 @@
 }
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url = "***"
 }
 model User {
-  id        Int             @id @default(autoincrement())
-  email     String          @unique
-  name      String?
-  image     String?
-  position  String?
+  id         Int          @id @default(autoincrement())
+  email      String       @unique
+  name       String?
+  image      String?
+  position   String?
   department String?
-  type      String?
-  skills    String[]
-  contacts  Contact         @relation(fields: [contactId], references: [id])
-  contactId Int
-  comments  Comment[]
-  projects  ProjectOnUser[]
-  tasks     TaskOnUser[]
-  role      Role            @default(USER)
+  type       String?
+  skills     String[]
+  contacts   Contact      @relation(fields: [contactId], references: [id])
+  contactId  Int
+  comments   Comment[]
+  projects   Project[]
+  tasks      TaskOnUser[]
+  role       Role         @default(USER)
 }
 model Contact {
   id        Int     @id @default(autoincrement())
@@ -34,28 +34,28 @@
   User      User[]
 }
 model Project {
-  id            Int             @id @default(autoincrement())
+  id            Int      @id @default(autoincrement())
   projectName   String?
   projectType   String?
   projectDetail String?
   projectImage  String?
-  status        String?         @default(value: "undone")
+  status        String?  @default(value: "undone")
   dueDate       DateTime
-  members       ProjectOnUser[]
+  members       User[]   @relation(references: [id])
   tasks         Task[]
 }
-model ProjectOnUser {
-  user      User     @relation(fields: [userId], references: [id])
-  userId    Int
-  project   Project  @relation(fields: [projectId], references: [id])
-  projectId Int
-  createdAt DateTime @default(now())
+// model ProjectOnUser {
+//   user      User     @relation(fields: [userId], references: [id])
+//   userId    Int
+//   project   Project  @relation(fields: [projectId], references: [id])
+//   projectId Int
+//   createdAt DateTime @default(now())
-  @@id([userId, projectId])
-}
+//   @@id([userId, projectId])
+// }
 model Task {
   id         Int          @id @default(autoincrement())
   project    Project      @relation(fields: [projectId], references: [id])
@@ -98,38 +98,20 @@
   @@id([taskId, fileId])
 }
 model Comment {
-  id        Int      @id @default(autoincrement())
-  user      User     @relation(fields: [userId], references: [id])
+  id        Int       @id @default(autoincrement())
+  user      User      @relation(fields: [userId], references: [id])
   userId    Int
-  task      Task     @relation(fields: [taskId], references: [id])
+  task      Task      @relation(fields: [taskId], references: [id])
   taskId    Int
-  timestamp DateTime @default(now())
+  timestamp DateTime  @default(now())
   image     String?
   message   String?
   replyId   Int?
-  reply     Comment? @relation("ReplyComment", fields: [replyId], references: [id])
+  reply     Comment?  @relation("ReplyComment", fields: [replyId], references: [id])
 }
-// model CommentOnUser {
-//   user      User     @relation(fields: [userId], references: [id])
-//   userId    Int
-//   comment   Comment  @relation(fields: [commentId], references: [id])
-//   commentId Int
-//   cretedAt  DateTime @default(now())
-//   @@id([userId, commentId])
-// }
-
-// model CommentOnTask {
-//   task      Task     @relation(fields: [taskId], references: [id])
-//   taskId    Int
-//   comment   Comment  @relation(fields: [commentId], references: [id])
-//   commentId Int
-//   cretedAt  DateTime @default(now())
-//   @@id([taskId, commentId])
-// }
-
 enum Role {
   ADMIN
   USER
 }
```



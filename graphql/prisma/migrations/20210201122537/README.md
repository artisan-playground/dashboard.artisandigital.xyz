# Migration `20210201122537`

This migration has been generated by Kullanan Thanachotnan at 2/1/2021, 7:25:39 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TYPE "public"."Role" AS ENUM ('ADMIN', 'USER')

CREATE TABLE "public"."User" (
"id" SERIAL,
"email" text   NOT NULL ,
"name" text   NOT NULL ,
"imageId" integer   ,
"position" text   ,
"department" text   ,
"type" text   ,
"phone" text   ,
"startDate" timestamp(3)   DEFAULT CURRENT_TIMESTAMP,
"dueDate" timestamp(3)   ,
"role" "Role"  NOT NULL DEFAULT E'USER',
PRIMARY KEY ("id")
)

CREATE TABLE "public"."Project" (
"id" SERIAL,
"projectName" text   ,
"projectType" text   ,
"projectDetail" text   ,
"projectImageId" integer   ,
"status" text   DEFAULT E'undone',
"createdAt" timestamp(3)   DEFAULT CURRENT_TIMESTAMP,
"dueDate" timestamp(3)   ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."Task" (
"id" SERIAL,
"projectId" integer   NOT NULL ,
"taskName" text   ,
"startTime" timestamp(3)   DEFAULT CURRENT_TIMESTAMP,
"endTime" timestamp(3)   ,
"taskDetail" text   ,
"taskType" text   ,
"isDone" boolean   DEFAULT false,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."File" (
"id" SERIAL,
"fileName" text   NOT NULL ,
"fullPath" text   NOT NULL ,
"path" text   NOT NULL ,
"extension" text   NOT NULL ,
"endpoint" text   NOT NULL ,
"taskId" integer   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."Comment" (
"id" SERIAL,
"userId" integer   NOT NULL ,
"taskId" integer   NOT NULL ,
"timestamp" timestamp(3)   DEFAULT CURRENT_TIMESTAMP,
"message" text   ,
"replyId" integer   ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."Event" (
"id" SERIAL,
"eventDate" timestamp(3)   DEFAULT CURRENT_TIMESTAMP,
"endDate" timestamp(3)   ,
"eventName" text   NOT NULL ,
"note" text   ,
"tag" text   ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."Image" (
"id" SERIAL,
"fileName" text   NOT NULL ,
"fullPath" text   NOT NULL ,
"path" text   NOT NULL ,
"extension" text   NOT NULL ,
"endpoint" text   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."ProjectImage" (
"id" SERIAL,
"fileName" text   NOT NULL ,
"fullPath" text   NOT NULL ,
"path" text   NOT NULL ,
"extension" text   NOT NULL ,
"endpoint" text   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."Zone" (
"id" SERIAL,
"name" text   NOT NULL ,
"longitude" text   NOT NULL ,
"latitude" text   NOT NULL ,
"timestamp" timestamp(3)   DEFAULT CURRENT_TIMESTAMP,
"radius" text   NOT NULL ,
"open" boolean   DEFAULT true,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."Content" (
"id" SERIAL,
"subject" text   NOT NULL ,
"content" text   NOT NULL ,
"timestamp" timestamp(3)   DEFAULT CURRENT_TIMESTAMP,
"userId" integer   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."ContentImage" (
"id" SERIAL,
"fileName" text   NOT NULL ,
"fullPath" text   NOT NULL ,
"path" text   NOT NULL ,
"extension" text   NOT NULL ,
"endpoint" text   NOT NULL ,
"contentId" integer   ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."Notification" (
"id" SERIAL,
"message" text   NOT NULL ,
"timestamp" timestamp(3)   DEFAULT CURRENT_TIMESTAMP,
"type" text   NOT NULL ,
"senderId" integer   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."RecentActivity" (
"id" SERIAL,
"message" text   NOT NULL ,
"timestamp" timestamp(3)   DEFAULT CURRENT_TIMESTAMP,
"userId" integer   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."_ProjectToUser" (
"A" integer   NOT NULL ,
"B" integer   NOT NULL 
)

CREATE TABLE "public"."_TaskToUser" (
"A" integer   NOT NULL ,
"B" integer   NOT NULL 
)

CREATE TABLE "public"."_EventToUser" (
"A" integer   NOT NULL ,
"B" integer   NOT NULL 
)

CREATE TABLE "public"."_NotificationToUser" (
"A" integer   NOT NULL ,
"B" integer   NOT NULL 
)

CREATE UNIQUE INDEX "User.email_unique" ON "public"."User"("email")

CREATE UNIQUE INDEX "_ProjectToUser_AB_unique" ON "public"."_ProjectToUser"("A", "B")

CREATE INDEX "_ProjectToUser_B_index" ON "public"."_ProjectToUser"("B")

CREATE UNIQUE INDEX "_TaskToUser_AB_unique" ON "public"."_TaskToUser"("A", "B")

CREATE INDEX "_TaskToUser_B_index" ON "public"."_TaskToUser"("B")

CREATE UNIQUE INDEX "_EventToUser_AB_unique" ON "public"."_EventToUser"("A", "B")

CREATE INDEX "_EventToUser_B_index" ON "public"."_EventToUser"("B")

CREATE UNIQUE INDEX "_NotificationToUser_AB_unique" ON "public"."_NotificationToUser"("A", "B")

CREATE INDEX "_NotificationToUser_B_index" ON "public"."_NotificationToUser"("B")

ALTER TABLE "public"."User" ADD FOREIGN KEY("imageId")REFERENCES "public"."Image"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."Project" ADD FOREIGN KEY("projectImageId")REFERENCES "public"."ProjectImage"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."Task" ADD FOREIGN KEY("projectId")REFERENCES "public"."Project"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."File" ADD FOREIGN KEY("taskId")REFERENCES "public"."Task"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."Comment" ADD FOREIGN KEY("userId")REFERENCES "public"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."Comment" ADD FOREIGN KEY("taskId")REFERENCES "public"."Task"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."Comment" ADD FOREIGN KEY("replyId")REFERENCES "public"."Comment"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."Content" ADD FOREIGN KEY("userId")REFERENCES "public"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."ContentImage" ADD FOREIGN KEY("contentId")REFERENCES "public"."Content"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."Notification" ADD FOREIGN KEY("senderId")REFERENCES "public"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."RecentActivity" ADD FOREIGN KEY("userId")REFERENCES "public"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."_ProjectToUser" ADD FOREIGN KEY("A")REFERENCES "public"."Project"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."_ProjectToUser" ADD FOREIGN KEY("B")REFERENCES "public"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."_TaskToUser" ADD FOREIGN KEY("A")REFERENCES "public"."Task"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."_TaskToUser" ADD FOREIGN KEY("B")REFERENCES "public"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."_EventToUser" ADD FOREIGN KEY("A")REFERENCES "public"."Event"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."_EventToUser" ADD FOREIGN KEY("B")REFERENCES "public"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."_NotificationToUser" ADD FOREIGN KEY("A")REFERENCES "public"."Notification"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."_NotificationToUser" ADD FOREIGN KEY("B")REFERENCES "public"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration ..20210201122537
--- datamodel.dml
+++ datamodel.dml
@@ -1,0 +1,160 @@
+generator prisma_client {
+  provider = "prisma-client-js"
+}
+
+datasource db {
+  provider = "postgresql"
+  url = "***"
+}
+
+model User {
+  id            Int             @id @default(autoincrement())
+  email         String          @unique
+  name          String
+  image         Image?          @relation(fields: [imageId], references: [id])
+  imageId       Int?
+  position      String?
+  department    String?
+  type          String?
+  phone         String?
+  comments      Comment[]
+  projects      Project[]
+  tasks         Task[]
+  event         Event[]
+  startDate     DateTime?        @default(now())
+  dueDate       DateTime?
+  notifications Notification[]
+  contents      Content[]
+  role          Role             @default(USER)
+}
+
+model Project {
+  id              Int             @id @default(autoincrement())
+  projectName     String?
+  projectType     String?
+  projectDetail   String?
+  projectImage    ProjectImage?   @relation(fields: [projectImageId], references: [id])
+  projectImageId  Int?
+  status          String?         @default(value: "undone")
+  createdAt        DateTime?       @default(now())
+  dueDate         DateTime?
+  members         User[]
+  tasks           Task[]
+}
+
+model Task {
+  id         Int          @id @default(autoincrement())
+  project    Project      @relation(fields: [projectId], references: [id])
+  projectId  Int
+  taskName   String?
+  startTime  DateTime?    @default(now())
+  endTime    DateTime?
+  taskDetail String?
+  taskType   String?
+  isDone     Boolean?     @default(value: false)
+  members    User[]
+  files      File[]
+  comments   Comment[]
+}
+
+model File {
+  task      Task
+  id        Int     @id @default(autoincrement())
+  fileName  String
+  fullPath  String
+  path      String
+  extension String
+  endpoint  String
+}
+
+model Comment {
+  id        Int        @id @default(autoincrement())
+  user      User       @relation(fields: [userId], references: [id])
+  userId    Int
+  task      Task       @relation(fields: [taskId], references: [id])
+  taskId    Int
+  timestamp DateTime?  @default(now())
+  message   String?
+  replyId   Int?
+  reply     Comment?   @relation("ReplyComment", fields: [replyId], references: [id])
+}
+
+model Event {
+  id        Int        @id @default(autoincrement())
+  eventDate DateTime?  @default(now())
+  endDate   DateTime?
+  eventName String
+  note      String?
+  tag       String?
+  invited   User[]
+}
+
+model Image {
+  id        Int     @id @default(autoincrement())
+  fileName  String
+  fullPath  String
+  path      String
+  extension String
+  endpoint  String
+}
+
+model ProjectImage {
+  id        Int     @id @default(autoincrement())
+  fileName  String
+  fullPath  String
+  path      String
+  extension String
+  endpoint  String
+}
+
+model Zone {
+  id        Int     @id @default(autoincrement())
+  name      String
+  longitude String
+  latitude  String
+  timestamp DateTime?  @default(now())
+  radius    String
+  open      Boolean?   @default(value: true)
+}
+
+model Content {
+  id            Int             @id @default(autoincrement())
+  subject       String
+  content       String
+  contentImage  ContentImage[]
+  timestamp     DateTime?       @default(now())
+  user          User            @relation(fields: [userId], references: [id])
+  userId        Int
+}
+
+model ContentImage {
+  id        Int     @id @default(autoincrement())
+  fileName  String
+  fullPath  String
+  path      String
+  extension String
+  endpoint  String
+}
+
+model Notification {
+  id        Int       @id @default(autoincrement())
+  message   String
+  timestamp DateTime? @default(now())
+  type      String
+  sender    User      @relation(name:"senderNotify",fields: [senderId], references: [id])
+  senderId  Int
+  receiver  User[]
+}
+
+model RecentActivity {
+  id        Int       @id @default(autoincrement())
+  message   String
+  timestamp DateTime? @default(now())
+  user      User      @relation(fields: [userId], references: [id])
+  userId    Int
+}
+
+enum Role {
+  ADMIN
+  USER
+}
```



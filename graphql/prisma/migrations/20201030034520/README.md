# Migration `20201030034520`

This migration has been generated by Kullanan at 10/30/2020, 10:45:21 AM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TYPE "public"."Role" AS ENUM ('ADMIN', 'USER')

CREATE TABLE "public"."User" (
"id" SERIAL,
"email" text   NOT NULL ,
"name" text   NOT NULL ,
"position" text   ,
"department" text   ,
"type" text   ,
"skills" text []  ,
"contactId" integer   ,
"startDate" timestamp(3)   DEFAULT CURRENT_TIMESTAMP,
"dueDate" timestamp(3)   ,
"role" "Role"  NOT NULL DEFAULT E'USER',
"imageId" integer   ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."Contact" (
"id" SERIAL,
"facebook" text   ,
"twitter" text   ,
"instagram" text   ,
"gitlab" text   ,
"github" text   ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."Project" (
"id" SERIAL,
"projectName" text   ,
"projectType" text   ,
"projectDetail" text   ,
"projectImage" text   ,
"status" text   DEFAULT E'undone',
"dueDate" timestamp(3)   ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."Task" (
"id" SERIAL,
"projectId" integer   NOT NULL ,
"taskName" text   ,
"startTime" timestamp(3)   DEFAULT CURRENT_TIMESTAMP,
"endTime" timestamp(3)   ,
"taskDetail" text   ,
"isDone" boolean   DEFAULT false,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."File" (
"id" SERIAL,
"url" text   ,
"name" text   ,
"status" text   ,
"taskId" integer   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."Comment" (
"id" SERIAL,
"userId" integer   NOT NULL ,
"taskId" integer   NOT NULL ,
"timestamp" timestamp(3)   DEFAULT CURRENT_TIMESTAMP,
"image" text   ,
"message" text   ,
"replyId" integer   ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."Event" (
"id" SERIAL,
"eventDate" timestamp(3)   DEFAULT CURRENT_TIMESTAMP,
"endDate" timestamp(3)   ,
"eventName" text   NOT NULL ,
"note" text   ,
"tag" text   ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."Image" (
"id" SERIAL,
"endpoint" text   NOT NULL ,
"path" text   NOT NULL ,
"fullPath" text   NOT NULL ,
"fileName" text   NOT NULL ,
"extension" text   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."_ProjectToUser" (
"A" integer   NOT NULL ,
"B" integer   NOT NULL 
)

CREATE TABLE "public"."_TaskToUser" (
"A" integer   NOT NULL ,
"B" integer   NOT NULL 
)

CREATE TABLE "public"."_EventToUser" (
"A" integer   NOT NULL ,
"B" integer   NOT NULL 
)

CREATE UNIQUE INDEX "User.email_unique" ON "public"."User"("email")

CREATE UNIQUE INDEX "_ProjectToUser_AB_unique" ON "public"."_ProjectToUser"("A", "B")

CREATE INDEX "_ProjectToUser_B_index" ON "public"."_ProjectToUser"("B")

CREATE UNIQUE INDEX "_TaskToUser_AB_unique" ON "public"."_TaskToUser"("A", "B")

CREATE INDEX "_TaskToUser_B_index" ON "public"."_TaskToUser"("B")

CREATE UNIQUE INDEX "_EventToUser_AB_unique" ON "public"."_EventToUser"("A", "B")

CREATE INDEX "_EventToUser_B_index" ON "public"."_EventToUser"("B")

ALTER TABLE "public"."User" ADD FOREIGN KEY("imageId")REFERENCES "public"."Image"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."User" ADD FOREIGN KEY("contactId")REFERENCES "public"."Contact"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."Task" ADD FOREIGN KEY("projectId")REFERENCES "public"."Project"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."File" ADD FOREIGN KEY("taskId")REFERENCES "public"."Task"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."Comment" ADD FOREIGN KEY("userId")REFERENCES "public"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."Comment" ADD FOREIGN KEY("taskId")REFERENCES "public"."Task"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."Comment" ADD FOREIGN KEY("replyId")REFERENCES "public"."Comment"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."_ProjectToUser" ADD FOREIGN KEY("A")REFERENCES "public"."Project"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."_ProjectToUser" ADD FOREIGN KEY("B")REFERENCES "public"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."_TaskToUser" ADD FOREIGN KEY("A")REFERENCES "public"."Task"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."_TaskToUser" ADD FOREIGN KEY("B")REFERENCES "public"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."_EventToUser" ADD FOREIGN KEY("A")REFERENCES "public"."Event"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."_EventToUser" ADD FOREIGN KEY("B")REFERENCES "public"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration ..20201030034520
--- datamodel.dml
+++ datamodel.dml
@@ -1,0 +1,109 @@
+generator prisma_client {
+  provider = "prisma-client-js"
+}
+
+datasource db {
+  provider = "postgresql"
+  url = "***"
+}
+
+model User {
+  id         Int             @id @default(autoincrement())
+  email      String          @unique
+  name       String
+  image      Image?
+  position   String?
+  department String?
+  type       String?
+  skills     String[]
+  contacts   Contact?         @relation(fields: [contactId], references: [id])
+  contactId  Int?
+  comments   Comment[]
+  projects   Project[]
+  tasks      Task[]
+  event      Event[]
+  startDate  DateTime?        @default(now())
+  dueDate    DateTime?
+  role       Role             @default(USER)
+}
+
+model Contact {
+  id        Int       @id @default(autoincrement())
+  facebook  String?
+  twitter   String?
+  instagram String?
+  gitlab    String?
+  github    String?
+  User      User[]
+}
+
+model Project {
+  id            Int             @id @default(autoincrement())
+  projectName   String?
+  projectType   String?
+  projectDetail String?
+  projectImage  String?
+  status        String?         @default(value: "undone")
+  dueDate       DateTime?
+  members       User[]
+  tasks         Task[]
+}
+
+model Task {
+  id         Int          @id @default(autoincrement())
+  project    Project      @relation(fields: [projectId], references: [id])
+  projectId  Int
+  taskName   String?
+  startTime  DateTime?    @default(now())
+  endTime    DateTime?
+  taskDetail String?
+  isDone     Boolean?     @default(value: false)
+  members    User[]
+  files      File[]
+  comments   Comment[]
+}
+
+model File {
+  task   Task
+  id     Int        @id @default(autoincrement())
+  url    String?
+  name   String?
+  status String?
+}
+
+model Comment {
+  id        Int        @id @default(autoincrement())
+  user      User       @relation(fields: [userId], references: [id])
+  userId    Int
+  task      Task       @relation(fields: [taskId], references: [id])
+  taskId    Int
+  timestamp DateTime?  @default(now())
+  image     String?
+  message   String?
+  replyId   Int?
+  reply     Comment?   @relation("ReplyComment", fields: [replyId], references: [id])
+}
+
+model Event{
+  id        Int        @id @default(autoincrement())
+  eventDate DateTime?  @default(now())
+  endDate   DateTime?
+  eventName String
+  note      String?
+  tag       String?
+  invited   User[]
+}
+
+model Image {
+  id        Int     @id @default(autoincrement())
+  endpoint  String
+  path      String
+  fullPath  String
+  fileName  String
+  extension String
+}
+
+enum Role {
+  ADMIN
+  USER
+}
```



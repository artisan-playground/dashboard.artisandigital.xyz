# Migration `20200922081236`

This migration has been generated by Kullanan at 9/22/2020, 3:12:36 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TYPE "public"."Role" AS ENUM ('ADMIN', 'USER')

CREATE TABLE "public"."User" (
"id" SERIAL,
"email" text   NOT NULL ,
"name" text   ,
"image" text   ,
"position" text   ,
"skills" text []  ,
"role" "Role"  NOT NULL DEFAULT E'USER',
PRIMARY KEY ("id")
)

CREATE TABLE "public"."Contact" (
"id" SERIAL,
"facebook" text   ,
"twitter" text   ,
"instagram" text   ,
"gitlab" text   ,
"github" text   ,
"userId" integer   ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."Project" (
"id" SERIAL,
"projectName" text   ,
"projectType" text   ,
"projectDetail" text   ,
"projectImage" text   ,
"status" text   DEFAULT E'undone',
"dueDate" timestamp(3)   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."ProjectOnUser" (
"userId" integer   NOT NULL ,
"projectId" integer   NOT NULL ,
"createdAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
PRIMARY KEY ("userId","projectId")
)

CREATE TABLE "public"."Task" (
"id" SERIAL,
"projectId" integer   ,
"taskName" text   ,
"startTime" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"endTime" timestamp(3)   NOT NULL ,
"taskDetail" text   ,
"isDone" boolean   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."TaskOnUser" (
"userId" integer   NOT NULL ,
"taskId" integer   NOT NULL ,
"cretedAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
PRIMARY KEY ("userId","taskId")
)

CREATE TABLE "public"."File" (
"id" SERIAL,
"url" text   ,
"name" text   ,
"status" text   ,
"taskId" integer   ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."Comment" (
"id" SERIAL,
"timestamp" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"userId" integer   ,
"userImg" text   ,
"userName" text   ,
"image" text   ,
"message" text   ,
"taskId" integer   ,
PRIMARY KEY ("id")
)

CREATE UNIQUE INDEX "User.email_unique" ON "public"."User"("email")

ALTER TABLE "public"."Contact" ADD FOREIGN KEY ("userId")REFERENCES "public"."User"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."ProjectOnUser" ADD FOREIGN KEY ("userId")REFERENCES "public"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."ProjectOnUser" ADD FOREIGN KEY ("projectId")REFERENCES "public"."Project"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."Task" ADD FOREIGN KEY ("projectId")REFERENCES "public"."Project"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."TaskOnUser" ADD FOREIGN KEY ("userId")REFERENCES "public"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."TaskOnUser" ADD FOREIGN KEY ("taskId")REFERENCES "public"."Task"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."File" ADD FOREIGN KEY ("taskId")REFERENCES "public"."Task"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."Comment" ADD FOREIGN KEY ("userId")REFERENCES "public"."User"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."Comment" ADD FOREIGN KEY ("taskId")REFERENCES "public"."Task"("id") ON DELETE SET NULL ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration ..20200922081236
--- datamodel.dml
+++ datamodel.dml
@@ -1,0 +1,104 @@
+generator prisma_client {
+  provider = "prisma-client-js"
+}
+
+datasource db {
+  provider = "postgresql"
+  url = "***"
+}
+
+model User {
+  id       Int             @id @default(autoincrement())
+  email    String          @unique
+  name     String?
+  image    String?
+  position String?
+  skills   String[]
+  contacts Contact[]
+  comments Comment[]
+  role     Role            @default(USER)
+  projects ProjectOnUser[]
+  tasks    TaskOnUser[]
+}
+
+model Contact {
+  id        Int     @id @default(autoincrement())
+  facebook  String?
+  twitter   String?
+  instagram String?
+  gitlab    String?
+  github    String?
+  user      User?   @relation(fields: [userId], references: [id])
+  userId    Int?
+}
+
+model Project {
+  id            Int             @id @default(autoincrement())
+  projectName   String?
+  projectType   String?
+  projectDetail String?
+  projectImage  String?
+  status        String?         @default(value: "undone")
+  dueDate       DateTime
+  members       ProjectOnUser[]
+  task          Task[]
+}
+
+model ProjectOnUser {
+  user      User     @relation(fields: [userId], references: [id])
+  userId    Int
+  project   Project  @relation(fields: [projectId], references: [id])
+  projectId Int
+  createdAt DateTime @default(now())
+  @@id([userId, projectId])
+}
+
+model Task {
+  id         Int          @id @default(autoincrement())
+  Project    Project?     @relation(fields: [projectId], references: [id])
+  projectId  Int?
+  taskName   String?
+  startTime  DateTime     @default(now())
+  endTime    DateTime
+  taskDetail String?
+  isDone     Boolean
+  members    TaskOnUser[]
+  comments   Comment[]
+  files      File[]
+}
+
+model TaskOnUser {
+  user     User     @relation(fields: [userId], references: [id])
+  userId   Int
+  task     Task     @relation(fields: [taskId], references: [id])
+  taskId   Int
+  cretedAt DateTime @default(now())
+  @@id([userId, taskId])
+}
+
+model File {
+  id     Int     @id @default(autoincrement())
+  url    String?
+  name   String?
+  status String?
+  task   Task?   @relation(fields: [taskId], references: [id])
+  taskId Int?
+}
+
+model Comment {
+  id        Int      @id @default(autoincrement())
+  timestamp DateTime @default(now())
+  users     User?    @relation(fields: [userId], references: [id])
+  userId    Int?
+  userImg   String?
+  userName  String?
+  image     String?
+  message   String?
+  task      Task?    @relation(fields: [taskId], references: [id])
+  taskId    Int?
+}
+
+enum Role {
+  ADMIN
+  USER
+}
```



# Migration `20201013070348`

This migration has been generated by Kullanan at 10/13/2020, 2:03:48 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
ALTER TABLE "public"."FileOnTask" DROP CONSTRAINT "FileOnTask_fileId_fkey"

ALTER TABLE "public"."FileOnTask" DROP CONSTRAINT "FileOnTask_taskId_fkey"

ALTER TABLE "public"."TaskOnUser" DROP CONSTRAINT "TaskOnUser_taskId_fkey"

ALTER TABLE "public"."TaskOnUser" DROP CONSTRAINT "TaskOnUser_userId_fkey"

ALTER TABLE "public"."File" ADD COLUMN "taskId" integer   NOT NULL 

CREATE TABLE "public"."_TaskToUser" (
"A" integer   NOT NULL ,
"B" integer   NOT NULL 
)

CREATE UNIQUE INDEX "_TaskToUser_AB_unique" ON "public"."_TaskToUser"("A", "B")

CREATE INDEX "_TaskToUser_B_index" ON "public"."_TaskToUser"("B")

ALTER TABLE "public"."_TaskToUser" ADD FOREIGN KEY ("A")REFERENCES "public"."Task"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."_TaskToUser" ADD FOREIGN KEY ("B")REFERENCES "public"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."File" ADD FOREIGN KEY ("taskId")REFERENCES "public"."Task"("id") ON DELETE CASCADE ON UPDATE CASCADE

DROP TABLE "public"."FileOnTask"

DROP TABLE "public"."TaskOnUser"
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20201013060529..20201013070348
--- datamodel.dml
+++ datamodel.dml
@@ -3,26 +3,26 @@
 }
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url = "***"
 }
 model User {
-  id         Int          @id @default(autoincrement())
-  email      String       @unique
+  id         Int             @id @default(autoincrement())
+  email      String          @unique
   name       String?
   image      String?
   position   String?
   department String?
   type       String?
   skills     String[]
-  contacts   Contact      @relation(fields: [contactId], references: [id])
+  contacts   Contact         @relation(fields: [contactId], references: [id])
   contactId  Int
   comments   Comment[]
   projects   Project[]
-  tasks      TaskOnUser[]
-  role       Role         @default(USER)
+  tasks      Task[]
+  role       Role            @default(USER)
 }
 model Contact {
   id        Int     @id @default(autoincrement())
@@ -34,29 +34,19 @@
   User      User[]
 }
 model Project {
-  id            Int      @id @default(autoincrement())
+  id            Int             @id @default(autoincrement())
   projectName   String?
   projectType   String?
   projectDetail String?
   projectImage  String?
-  status        String?  @default(value: "undone")
+  status        String?         @default(value: "undone")
   dueDate       DateTime
-  members       User[]   @relation(references: [id])
+  members       User[]
   tasks         Task[]
 }
-// model ProjectOnUser {
-//   user      User     @relation(fields: [userId], references: [id])
-//   userId    Int
-//   project   Project  @relation(fields: [projectId], references: [id])
-//   projectId Int
-//   createdAt DateTime @default(now())
-
-//   @@id([userId, projectId])
-// }
-
 model Task {
   id         Int          @id @default(autoincrement())
   project    Project      @relation(fields: [projectId], references: [id])
   projectId  Int
@@ -64,41 +54,21 @@
   startTime  DateTime     @default(now())
   endTime    DateTime     @default(now())
   taskDetail String?
   isDone     Boolean
-  members    TaskOnUser[]
-  files      FileOnTask[]
+  members    User[]
+  files      File[]
   comments   Comment[]
 }
-model TaskOnUser {
-  user     User     @relation(fields: [userId], references: [id])
-  userId   Int
-  task     Task     @relation(fields: [taskId], references: [id])
-  taskId   Int
-  cretedAt DateTime @default(now())
-
-  @@id([userId, taskId])
-}
-
 model File {
-  task   FileOnTask
+  task   Task
   id     Int        @id @default(autoincrement())
   url    String?
   name   String?
   status String?
 }
-model FileOnTask {
-  task     Task     @relation(fields: [taskId], references: [id])
-  taskId   Int
-  file     File     @relation(fields: [fileId], references: [id])
-  fileId   Int
-  cretedAt DateTime @default(now())
-
-  @@id([taskId, fileId])
-}
-
 model Comment {
   id        Int       @id @default(autoincrement())
   user      User      @relation(fields: [userId], references: [id])
   userId    Int
```



# Migration `20200923090239`

This migration has been generated by Kullanan at 9/23/2020, 4:02:39 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TYPE "public"."Role" AS ENUM ('ADMIN', 'USER')

CREATE TABLE "public"."User" (
"id" SERIAL,
"email" text   NOT NULL ,
"name" text   ,
"image" text   ,
"position" text   ,
"skills" text []  ,
"contactId" integer   NOT NULL ,
"role" "Role"  NOT NULL DEFAULT E'USER',
PRIMARY KEY ("id")
)

CREATE TABLE "public"."Contact" (
"id" SERIAL,
"facebook" text   ,
"twitter" text   ,
"instagram" text   ,
"gitlab" text   ,
"github" text   ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."Project" (
"id" SERIAL,
"projectName" text   ,
"projectType" text   ,
"projectDetail" text   ,
"projectImage" text   ,
"status" text   DEFAULT E'undone',
"dueDate" timestamp(3)   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."ProjectOnUser" (
"userId" integer   NOT NULL ,
"projectId" integer   NOT NULL ,
"createdAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
PRIMARY KEY ("userId","projectId")
)

CREATE TABLE "public"."Task" (
"id" SERIAL,
"projectId" integer   NOT NULL ,
"taskName" text   ,
"startTime" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"endTime" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"taskDetail" text   ,
"isDone" boolean   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."TaskOnUser" (
"userId" integer   NOT NULL ,
"taskId" integer   NOT NULL ,
"cretedAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
PRIMARY KEY ("userId","taskId")
)

CREATE TABLE "public"."File" (
"id" SERIAL,
"url" text   ,
"name" text   ,
"status" text   ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."FileOnTask" (
"taskId" integer   NOT NULL ,
"fileId" integer   NOT NULL ,
"cretedAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
PRIMARY KEY ("taskId","fileId")
)

CREATE TABLE "public"."Comment" (
"id" SERIAL,
"timestamp" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"image" text   ,
"message" text   ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."CommentOnUser" (
"userId" integer   NOT NULL ,
"commentId" integer   NOT NULL ,
"cretedAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
PRIMARY KEY ("userId","commentId")
)

CREATE TABLE "public"."CommentOnTask" (
"taskId" integer   NOT NULL ,
"commentId" integer   NOT NULL ,
"cretedAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
PRIMARY KEY ("taskId","commentId")
)

CREATE UNIQUE INDEX "User.email_unique" ON "public"."User"("email")

CREATE UNIQUE INDEX "FileOnTask_fileId_unique" ON "public"."FileOnTask"("fileId")

CREATE UNIQUE INDEX "CommentOnTask_commentId_unique" ON "public"."CommentOnTask"("commentId")

ALTER TABLE "public"."User" ADD FOREIGN KEY ("contactId")REFERENCES "public"."Contact"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."ProjectOnUser" ADD FOREIGN KEY ("userId")REFERENCES "public"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."ProjectOnUser" ADD FOREIGN KEY ("projectId")REFERENCES "public"."Project"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."Task" ADD FOREIGN KEY ("projectId")REFERENCES "public"."Project"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."TaskOnUser" ADD FOREIGN KEY ("userId")REFERENCES "public"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."TaskOnUser" ADD FOREIGN KEY ("taskId")REFERENCES "public"."Task"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."FileOnTask" ADD FOREIGN KEY ("taskId")REFERENCES "public"."Task"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."FileOnTask" ADD FOREIGN KEY ("fileId")REFERENCES "public"."File"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."CommentOnUser" ADD FOREIGN KEY ("userId")REFERENCES "public"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."CommentOnUser" ADD FOREIGN KEY ("commentId")REFERENCES "public"."Comment"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."CommentOnTask" ADD FOREIGN KEY ("taskId")REFERENCES "public"."Task"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."CommentOnTask" ADD FOREIGN KEY ("commentId")REFERENCES "public"."Comment"("id") ON DELETE CASCADE ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration ..20200923090239
--- datamodel.dml
+++ datamodel.dml
@@ -1,0 +1,126 @@
+generator prisma_client {
+  provider = "prisma-client-js"
+}
+
+datasource db {
+  provider = "postgresql"
+  url = "***"
+}
+
+model User {
+  id        Int             @id @default(autoincrement())
+  email     String          @unique
+  name      String?
+  image     String?
+  position  String?
+  skills    String[]
+  contacts  Contact         @relation(fields: [contactId], references: [id])
+  contactId Int
+  comments  CommentOnUser[]
+  projects  ProjectOnUser[]
+  tasks     TaskOnUser[]
+  role      Role            @default(USER)
+}
+
+model Contact {
+  id        Int     @id @default(autoincrement())
+  facebook  String?
+  twitter   String?
+  instagram String?
+  gitlab    String?
+  github    String?
+  User      User[]
+}
+
+model Project {
+  id            Int             @id @default(autoincrement())
+  projectName   String?
+  projectType   String?
+  projectDetail String?
+  projectImage  String?
+  status        String?         @default(value: "undone")
+  dueDate       DateTime
+  members       ProjectOnUser[]
+  tasks         Task[]
+}
+
+model ProjectOnUser {
+  user      User     @relation(fields: [userId], references: [id])
+  userId    Int
+  project   Project  @relation(fields: [projectId], references: [id])
+  projectId Int
+  createdAt DateTime @default(now())
+  @@id([userId, projectId])
+}
+
+model Task {
+  id         Int             @id @default(autoincrement())
+  project    Project         @relation(fields: [projectId], references: [id])
+  projectId  Int
+  taskName   String?
+  startTime  DateTime        @default(now())
+  endTime    DateTime        @default(now())
+  taskDetail String?
+  isDone     Boolean
+  members    TaskOnUser[]
+  files      FileOnTask[]
+  comments   CommentOnTask[]
+}
+
+model TaskOnUser {
+  user     User     @relation(fields: [userId], references: [id])
+  userId   Int
+  task     Task     @relation(fields: [taskId], references: [id])
+  taskId   Int
+  cretedAt DateTime @default(now())
+  @@id([userId, taskId])
+}
+
+model File {
+  task   FileOnTask
+  id     Int        @id @default(autoincrement())
+  url    String?
+  name   String?
+  status String?
+}
+
+model FileOnTask {
+  task     Task     @relation(fields: [taskId], references: [id])
+  taskId   Int
+  file     File     @relation(fields: [fileId], references: [id])
+  fileId   Int
+  cretedAt DateTime @default(now())
+  @@id([taskId, fileId])
+}
+
+model Comment {
+  id        Int             @id @default(autoincrement())
+  users     CommentOnUser[]
+  task      CommentOnTask
+  timestamp DateTime        @default(now())
+  image     String?
+  message   String?
+}
+
+model CommentOnUser {
+  user      User     @relation(fields: [userId], references: [id])
+  userId    Int
+  comment   Comment  @relation(fields: [commentId], references: [id])
+  commentId Int
+  cretedAt  DateTime @default(now())
+  @@id([userId, commentId])
+}
+
+model CommentOnTask {
+  task      Task     @relation(fields: [taskId], references: [id])
+  taskId    Int
+  comment   Comment  @relation(fields: [commentId], references: [id])
+  commentId Int
+  cretedAt  DateTime @default(now())
+  @@id([taskId, commentId])
+}
+
+enum Role {
+  ADMIN
+  USER
+}
```


